<?xml version="1.0"?>
<robot name="tethys">
    <!-- Base Link -->
    <link name="base_link">
        <inertial>
            <mass value="147.85"/>
            <inertia ixx="3.000000" ixy="0" ixz="0" iyy="41.980233" iyz="0" izz="41.980233"/>
        </inertial>
        <collision name="main_body_buoyancy">
            <geometry>
                <box size="2 0.3 0.246445166667"/>
            </geometry>
        </collision>
        <visual name="visual">
            <geometry>
                <mesh filename="/home/ben/submarine/ros_ws/install/ros2_sub/share/ros2_sub/models/tethys/meshes/tethys.dae"/>
            </geometry>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <material name="white">
                <color rgba="1 1 1 1"/>
            </material>
        </visual>
    </link>

    <!-- Base Footprint -->
    <link name="base_footprint">
        <inertial>
            <mass value="0.00001"/>
            <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6"/>
        </inertial>
    </link>

    <!-- Horizontal Fins -->
    <link name="horizontal_fins">
        <inertial>
            <mass value="0.2"/>
            <inertia ixx="0.0007924568755" ixy="-0.0000000002674" ixz="0.0003978158176" iyy="0.0010546736475" iyz="-0.0000000006729" izz="0.0002633558262"/>
        </inertial>
        <collision name="collision">
            <geometry>
                <box size="0.1 0.1 0.02"/>
            </geometry>
        </collision>
        <visual name="visual">
            <geometry>
                <mesh filename="/home/ben/submarine/ros_ws/install/ros2_sub/share/ros2_sub/models/tethys/meshes/tethys.dae"/>
            </geometry>
            <material name="white">
                <color rgba="1 1 1 1"/>
            </material>
        </visual>
    </link>

    <!-- Vertical Fins -->
    <link name="vertical_fins">
        <inertial>
            <mass value="0.2"/>
            <inertia ixx="0.0007924568755" ixy="-0.0000000002674" ixz="0.0003978158176" iyy="0.0010546736475" iyz="-0.0000000006729" izz="0.0002633558262"/>
        </inertial>
        <collision name="collision">
            <geometry>
                <box size="0.1 0.1 0.02"/>
            </geometry>
        </collision>
        <visual name="visual">
            <geometry>
                <mesh filename="/home/ben/submarine/ros_ws/install/ros2_sub/share/ros2_sub/models/tethys/meshes/tethys.dae"/>
            </geometry>
            <material name="white">
                <color rgba="1 1 1 1"/>
            </material>
        </visual>
    </link>

    <!-- Propeller -->
    <link name="propeller">
        <inertial>
            <mass value="0.09"/>
            <inertia ixx="0.000143971303" ixy="0.000000000008" ixz="-0.000000000224" iyy="0.000140915448" iyz="-0.000025236433" izz="0.000033571862"/>
        </inertial>
        <collision name="collision">
            <geometry>
                <box size="0.03 0.1 0.03"/>
            </geometry>
        </collision>
        <visual name="visual">
            <geometry>
                <mesh filename="/home/ben/submarine/ros_ws/install/ros2_sub/share/ros2_sub/models/tethys/meshes/tethys.dae"/>
            </geometry>
            <material name="white">
                <color rgba="1 1 1 1"/>
            </material>
        </visual>
    </link>

    <!-- Joints -->
    <joint name="horizontal_fins_joint" type="revolute">
        <parent link="base_link"/>
        <child link="horizontal_fins"/>
        <axis xyz="0 1 0"/>
        <limit lower="-0.261799" upper="0.261799" effort="-1" velocity="-1"/>
    </joint>

    <joint name="vertical_fins_joint" type="revolute">
        <parent link="base_link"/>
        <child link="vertical_fins"/>
        <axis xyz="0 0 1"/>
        <limit lower="-0.261799" upper="0.261799" effort="-1" velocity="-1"/>
    </joint>

    <joint name="propeller_joint" type="revolute">
        <parent link="base_link"/>
        <child link="propeller"/>
        <axis xyz="1 0 0"/>
        <limit lower="-1e+12" upper="1e+12" effort="-1" velocity="-1"/>
    </joint>
        <!--Sonar sensors are not currently available in gz, so we will use lidar modified to be as close to the sonar specs as possible to simulate
        specs:
        Range: 5-600cm
        angle 8-16 degrees
        single range value
        ~71 Hz data rate-->
        <!--Front Sonar has larger distance since the gz model of the sub doesn't have a good enough turn radius-->
        <!-- Front Sonar -->
<link name="front_sonar">
    <inertial>
      <mass value="0.00001"/>
      <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6"/>
    </inertial>
    <collision>
      <origin xyz="-.8 0 0" rpy="0 0 -3.1415"/>
      <geometry>
        <box size=".0001 .0001 .0001"/>
      </geometry>
    </collision>
    <visual>
      <origin xyz="-.8 0 0" rpy="0 -1.5708 0"/>
      <geometry>
        <mesh filename="package://models/tethys/meshes/MaxSonar.dae" scale=".001 .001 .001"/>
      </geometry>
      <material name="black">
        <color rgba="0 0 0 0.1"/>
      </material>
    </visual>
  </link>
  
  <gazebo reference="front_sonar">
      <sensor name="front_sonar_sensor" type="ray">
      <update_rate>71</update_rate>
      <pose>0 0 0 0 0 0</pose>
      <ray>
        <scan>
        <horizontal>
          <samples>1</samples>
          <resolution>1</resolution>
          <min_angle>0</min_angle>
          <max_angle>0</max_angle>
        </horizontal>
        </scan>
        <range>
          <min>0.5</min>
          <max>20</max>
          <resolution>0.01</resolution>
        </range>
      </ray>
      <visualize>true</visualize>
      <plugin name="front_sonar_controller" filename="libgazebo_ros_laser.so">
        <topicName>/scan/front</topicName>
        <frameName>front_sonar</frameName>
      </plugin>
    </sensor>
  </gazebo>

<!-- Left Sonar -->
<link name="left_sonar">
    <pose relative_to="base_link">-.7 -.1 0 0 0 -1.5708</pose>
    <inertial>
        <mass value="0.00001"/>
        <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6"/>
    </inertial>
    <collision name="left_sonar_collision">
        <geometry>
            <box size=".0001 .0001 .0001"/>
        </geometry>
    </collision>
    <visual name="visual">
        <pose relative_to="base_link">-.7 -.1 0 1.5708 -1.5708 0</pose>
        <geometry>
            <mesh filename="package://models/tethys/meshes/MaxSonar.dae" scale=".001 .001 .001"/>
        </geometry>
        <material name="black">
            <color rgba="0 0 0 0.1"/>
        </material>
    </visual>
    <sensor name="left_sonar" type="gpu_lidar">
        <pose>0 0 0 0 0 0</pose>
        <topic>scan/left</topic>
        <gz_frame_id>left_sonar</gz_frame_id>
        <update_rate>25</update_rate>
        <lidar>
            <scan>
                <horizontal>
                    <samples>10</samples>
                    <resolution>1</resolution>
                    <min_angle>-.14</min_angle>
                    <max_angle>.14</max_angle>
                </horizontal>
                <vertical>
                    <samples>1</samples>
                    <resolution>1</resolution>
                    <min_angle>0</min_angle>
                    <max_angle>0</max_angle>
                </vertical>
            </scan>
            <range>
                <min>0.05</min>
                <max>15</max>
                <resolution>0.02</resolution>
            </range>
        </lidar>
        <visualize>true</visualize>
    </sensor>
</link>

<!-- Down Sonar -->
<link name="down_sonar">
    <pose relative_to="base_link">-.7 0 -.1 0 1.5708 0</pose>
    <inertial>
        <mass value="0.00001"/>
        <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6"/>
    </inertial>
    <collision name="down_sonar_collision">
        <geometry>
            <box size=".0001 .0001 .0001"/>
        </geometry>
    </collision>
    <visual name="visual">
        <pose relative_to="base_link">-.7 0 -.1 0 -3.1416 0</pose>
        <geometry>
            <mesh filename="package://models/tethys/meshes/MaxSonar.dae" scale=".001 .001 .001"/>
        </geometry>
        <material name="black">
            <color rgba="0 0 0 0.1"/>
        </material>
    </visual>
    <sensor name="down_sonar" type="gpu_lidar">
        <pose>0 0 0 0 0 0</pose>
        <topic>scan/down</topic>
        <gz_frame_id>down_sonar</gz_frame_id>
        <update_rate>70</update_rate>
        <lidar>
            <scan>
                <horizontal>
                    <samples>1</samples>
                    <resolution>1</resolution>
                    <min_angle>0</min_angle>
                    <max_angle>0</max_angle>
                </horizontal>
                <vertical>
                    <samples>1</samples>
                    <resolution>1</resolution>
                    <min_angle>0</min_angle>
                    <max_angle>0</max_angle>
                </vertical>
            </scan>
            <range>
                <min>0.05</min>
                <max>9</max>
                <resolution>0.01</resolution>
            </range>
        </lidar>
        <visualize>true</visualize>
    </sensor>
</link>

<!-- IMU -->
<link name="imu">
    <pose relative_to="base_link">0 0 0 0 0 0</pose>
    <inertial>
        <mass value="0.00001"/>
        <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6"/>
    </inertial>
    <visual name="visual">
        <geometry>
            <box size=".02 .02 .01"/>
        </geometry>
    </visual>
    <collision name="collision">
        <pose>0 0 0 0 0 0</pose>
        <geometry>
            <box size=".02 .02 .01"/>
        </geometry>
    </collision>
    <sensor name="imu_sensor" type="imu">
        <gz_frame_id>imu</gz_frame_id>
        <always_on>1</always_on>
        <update_rate>60</update_rate>
        <visualize>true</visualize>
        <topic>imu</topic>
        <enable_metrics>true</enable_metrics>
    </sensor>
</link>
<!-- Odometer -->
<link name="odometer">
    <inertial>
        <mass value="0.00001"/>
        <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6"/>
    </inertial>
    <collision name="collision">
        <pose>0 0 0 0 0 0</pose>
        <geometry>
            <box size="0.02 0.02 0.01"/>
        </geometry>
    </collision>
    <visual name="visual">
        <geometry>
            <box size="0.02 0.02 0.01"/>
        </geometry>
    </visual>
    <!-- Custom sensor -->
    <sensor name="an_odometer" type="custom" gz:type="odometer">
        <always_on>1</always_on>
        <update_rate>30</update_rate>
        <visualize>true</visualize>
        <gz:odometer>
            <noise type="gaussian">
                <mean>0.00001</mean>
                <stddev>0.00001</stddev>
            </noise>
        </gz:odometer>
        <topic>odometer</topic>
    </sensor>
</link>

<!-- Fixed Joints -->
<joint name="odometer_joint" type="fixed">
    <parent link="base_link"/>
    <child link="odometer"/>
</joint>

<joint name="imu_joint" type="fixed">
    <parent link="base_link"/>
    <child link="imu"/>
</joint>

<joint name="down_sonar_joint" type="fixed">
    <parent link="base_link"/>
    <child link="down_sonar"/>
</joint>

<joint name="front_sonar_joint" type="fixed">
    <parent link="base_link"/>
    <child link="front_sonar"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
</joint>

<joint name="left_sonar_joint" type="fixed">
    <parent link="base_link"/>
    <child link="left_sonar"/>
</joint>

<joint name="base_footprint_joint" type="fixed">
    <parent link="base_link"/>
    <child link="base_footprint"/>
</joint>

    </robot>
